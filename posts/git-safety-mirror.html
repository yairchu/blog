<!DOCTYPE html>
<html lang="en" dir="ltr">
<head profile="http://www.w3.org/2005/10/profile">
  <meta name="description" content="Yair&#39;s website">
  <meta name="author" content="Yair Chuchem">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@yairchu">
<meta name="twitter:creator" content="@yairchu">
<meta name="twitter:title" content="Git safety mirror">
  <meta name="twitter:description" content="A utility to create git mirrors which protect against commits lost due
to force pushes">
  <meta name="twitter:image" content="https://yairchu.github.io//images/safety-mirror.jpg">
  <title>Git safety mirror</title>
  <link rel="stylesheet" href="/css/syntax.css">
  <meta property="og:title" content="Git safety mirror" />
  <meta property="og:image" content="https://yairchu.github.io/images/safety-mirror.jpg" />
  <meta charset="UTF-8">
  <meta name=viewport content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/style.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZVL4J64MW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3ZVL4J64MW');
  </script>
</head>
<body>
  <header dir="ltr">
      <nav>
          <a href="/"> HOME </a>
          <a href="/projects/recommendations"> FAVS </a>
      </nav>
  
      <div class="right-sidebar">
          <a class="ext-link" href="https://github.com/yairchu">
            <img src="/images/github-logo.png" alt="Github Profile"/>
        </a>

          <a class="ext-link" href="https://twitter.com/yairchu">
            <img src="/images/twitter-logo.png" alt="Twitter Profile"/>
        </a>
    <div id="theme-button">DAY</div>
      </div>
  </header>

<div id="page">
  <div class="wrapper">
    <div class="masthead">
      <span class="title">
        Git safety mirror
      </span>

      <img class="post-image" src="/images/safety-mirror.jpg">
      <span class="byline">by Yair Chuchem</span>
      <span class="date">2023.10.05</span>
      <div class="metadata">
      </div>
      <div class="tags">
        <a href="/tag/git" class="tag">git</a>
        <a href="/tag/code" class="tag">code</a>
      </div>
    </div>
  </div>
  <article class="post">

    <p>When someone <code>git push --force</code> to a public repo which is
a dependency of your project, the commit you've used may no longer work.
Your projects will fail building and you'll be forced to update to a new
version as well as lose the reproducibility of your older versions
(which are useful for <code>git bisect</code>s). That's why you
shouldn't <code>git push --force</code> to the main branches of public
repos.</p>
<p>But what can you do when your dependencies are maintained by other
people who do it anyway?</p>
<p>Here's a new solution to this problem: create a "safety mirror" for
the project.</p>
<h2 id="the-anatomy-of-a-safety-mirror-repository">The anatomy of a
safety mirror repository</h2>
<p><img src="/images/safety-mirror-commits.svg"
alt="Git history for a safety mirror" /></p>
<ul>
<li>A safety mirror <a
href="https://github.com/yairchu/safety-mirror">starts from the
repository of <code>safety-mirror</code> tool</a></li>
<li>Then the user sets up the repositories and branches to mirror in
<code>sources.json</code></li>
<li>Subsequent runs of <code>safety-mirror.py</code> create quasi-merge
commits of the sources into the mirror.
<ul>
<li>They differ from typical merge commits in that the mirrored
repository's contents are not actually entering main branch of the
safety mirror (which stays just the script and its configuration)</li>
<li>The purpose these merge commits serve is simply to keep the history
of the mirrored repository attached to the safety mirror's history, so
that it never gets lost</li>
</ul></li>
</ul>
<p>To then use the safety mirror as a dependency, simply use it instead
of the original repository, with the original repository's commit hashes
(which are mirrored). Unlike the original repository, when you update
your safety mirror no commits will ever get lost.</p>

    <!--Comments-->
    <script src="https://giscus.app/client.js"
      data-repo="yairchu/yairchu.github.io"
      data-repo-id="MDEwOlJlcG9zaXRvcnkyMTI0MDQ3MDk="
      data-category="Announcements"
      data-category-id="DIC_kwDODKkJ5c4Ckke9"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="light"
      data-lang="en"
      crossorigin="anonymous"
      async>
    </script>

    <!--Share buttons-->
    <div class="social-buttons">
      <a href="https://twitter.com/share" class="twitter-share-button" data-text="Check out: Git safety mirror - " data-via="yairchu">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      <a href="https://twitter.com/yairchu" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @yairchu</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      <div class="fb-like" data-href="" data-layout="button" data-action="like" data-show-faces="true" data-share="true"></div>
    </div>
  </article>

</div>

<footer>
    Web site built with Haskell using <a href="https://github.com/ChrisPenner/slick">slick</a> ❤️
</footer>

<link href='https://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<script src="/js/main.js"></script>
</body>
</html>
